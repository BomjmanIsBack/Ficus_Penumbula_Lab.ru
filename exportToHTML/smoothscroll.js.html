<html>
<head>
<title>smoothscroll.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
.s6 { color: #629755; font-weight: bold; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
smoothscroll.js</font>
</center></td></tr></table>
<pre><span class="s0">//</span>
<span class="s0">// SmoothScroll for websites v1.4.0 (Balazs Galambosi)</span>
<span class="s0">// http://www.smoothscroll.net/</span>
<span class="s0">//</span>
<span class="s0">// Licensed under the terms of the MIT license.</span>
<span class="s0">//</span>
<span class="s0">// You may use it in your theme if you credit me. </span>
<span class="s0">// It is also free to use on any individual website.</span>
<span class="s0">//</span>
<span class="s0">// Exception:</span>
<span class="s0">// The only restriction is to not publish any  </span>
<span class="s0">// extension for browsers or native application</span>
<span class="s0">// without getting a written permission first.</span>
<span class="s0">//</span>

<span class="s1">(</span><span class="s2">function </span><span class="s1">() {</span>
  
<span class="s0">// Scroll Variables (tweakable)</span>
<span class="s2">var </span><span class="s1">defaultOptions = {</span>

    <span class="s0">// Scrolling Core</span>
    <span class="s1">frameRate        : </span><span class="s3">150</span><span class="s2">, </span><span class="s0">// [Hz]</span>
    <span class="s1">animationTime    : </span><span class="s3">400</span><span class="s2">, </span><span class="s0">// [ms]</span>
    <span class="s1">stepSize         : </span><span class="s3">60</span><span class="s2">, </span><span class="s0">// [px]</span>

    <span class="s0">// Pulse (less tweakable)</span>
    <span class="s0">// ratio of &quot;tail&quot; to &quot;acceleration&quot;</span>
    <span class="s1">pulseAlgorithm   : </span><span class="s2">true,</span>
    <span class="s1">pulseScale       : </span><span class="s3">4</span><span class="s2">,</span>
    <span class="s1">pulseNormalize   : </span><span class="s3">1</span><span class="s2">,</span>

    <span class="s0">// Acceleration</span>
    <span class="s1">accelerationDelta : </span><span class="s3">50</span><span class="s2">,  </span><span class="s0">// 50</span>
    <span class="s1">accelerationMax   : </span><span class="s3">3</span><span class="s2">,   </span><span class="s0">// 3</span>

    <span class="s0">// Keyboard Settings</span>
    <span class="s1">keyboardSupport   : </span><span class="s2">true,  </span><span class="s0">// option</span>
    <span class="s1">arrowScroll       : </span><span class="s3">50</span><span class="s2">,    </span><span class="s0">// [px]</span>

    <span class="s0">// Other</span>
    <span class="s1">touchpadSupport   : </span><span class="s2">false, </span><span class="s0">// ignore touchpad by default</span>
    <span class="s1">fixedBackground   : </span><span class="s2">true, </span>
    <span class="s1">excluded          : </span><span class="s4">''    </span>
<span class="s1">}</span><span class="s2">;</span>

<span class="s2">var </span><span class="s1">options = defaultOptions</span><span class="s2">;</span>


<span class="s0">// Other Variables</span>
<span class="s2">var </span><span class="s1">isExcluded = </span><span class="s2">false;</span>
<span class="s2">var </span><span class="s1">isFrame = </span><span class="s2">false;</span>
<span class="s2">var </span><span class="s1">direction = { x: </span><span class="s3">0</span><span class="s2">, </span><span class="s1">y: </span><span class="s3">0 </span><span class="s1">}</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">initDone  = </span><span class="s2">false;</span>
<span class="s2">var </span><span class="s1">root = document.documentElement</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">activeElement</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">observer</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">refreshSize</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">deltaBuffer = []</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">isMac = </span><span class="s3">/^Mac/</span><span class="s1">.test(navigator.platform)</span><span class="s2">;</span>

<span class="s2">var </span><span class="s1">key = { left: </span><span class="s3">37</span><span class="s2">, </span><span class="s1">up: </span><span class="s3">38</span><span class="s2">, </span><span class="s1">right: </span><span class="s3">39</span><span class="s2">, </span><span class="s1">down: </span><span class="s3">40</span><span class="s2">, </span><span class="s1">spacebar: </span><span class="s3">32</span><span class="s2">, </span>
            <span class="s1">pageup: </span><span class="s3">33</span><span class="s2">, </span><span class="s1">pagedown: </span><span class="s3">34</span><span class="s2">, </span><span class="s1">end: </span><span class="s3">35</span><span class="s2">, </span><span class="s1">home: </span><span class="s3">36 </span><span class="s1">}</span><span class="s2">;</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* INITIALIZE</span>
 <span class="s5">***********************************************/</span>

<span class="s5">/**</span>
 <span class="s5">* Tests if smooth scrolling is allowed. Shuts down everything if not.</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">initTest() {</span>
    <span class="s2">if </span><span class="s1">(options.keyboardSupport) {</span>
        <span class="s1">addEvent(</span><span class="s4">'keydown'</span><span class="s2">, </span><span class="s1">keydown)</span><span class="s2">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">* Sets up scrolls array, determines if frames are involved.</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">init() {</span>
  
    <span class="s2">if </span><span class="s1">(initDone || !document.body) </span><span class="s2">return;</span>

    <span class="s1">initDone = </span><span class="s2">true;</span>

    <span class="s2">var </span><span class="s1">body = document.body</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">html = document.documentElement</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">windowHeight = window.innerHeight</span><span class="s2">; </span>
    <span class="s2">var </span><span class="s1">scrollHeight = body.scrollHeight</span><span class="s2">;</span>
    
    <span class="s0">// check compat mode for root element</span>
    <span class="s1">root = (document.compatMode.indexOf(</span><span class="s4">'CSS'</span><span class="s1">) &gt;= </span><span class="s3">0</span><span class="s1">) ? html : body</span><span class="s2">;</span>
    <span class="s1">activeElement = body</span><span class="s2">;</span>
    
    <span class="s1">initTest()</span><span class="s2">;</span>

    <span class="s0">// Checks if this script is running in a frame</span>
    <span class="s2">if </span><span class="s1">(top != self) {</span>
        <span class="s1">isFrame = </span><span class="s2">true;</span>
    <span class="s1">}</span>

    <span class="s5">/**</span>
     <span class="s5">* Please duplicate this radar for a Safari fix! </span>
     <span class="s5">* rdar://22376037</span>
     <span class="s5">* https://openradar.appspot.com/radar?id=4965070979203072</span>
     <span class="s5">* </span>
     <span class="s5">* Only applies to Safari now, Chrome fixed it in v45:</span>
     <span class="s5">* This fixes a bug where the areas left and right to </span>
     <span class="s5">* the content does not trigger the onmousewheel event</span>
     <span class="s5">* on some pages. e.g.: html, body { height: 100% }</span>
     <span class="s5">*/</span>
    <span class="s2">else if </span><span class="s1">(scrollHeight &gt; windowHeight &amp;&amp;</span>
            <span class="s1">(body.offsetHeight &lt;= windowHeight || </span>
             <span class="s1">html.offsetHeight &lt;= windowHeight)) {</span>

        <span class="s2">var </span><span class="s1">fullPageElem = document.createElement(</span><span class="s4">'div'</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s1">fullPageElem.style.cssText = </span><span class="s4">'position:absolute; z-index:-10000; ' </span><span class="s1">+</span>
                                     <span class="s4">'top:0; left:0; right:0; height:' </span><span class="s1">+ </span>
                                      <span class="s1">root.scrollHeight + </span><span class="s4">'px'</span><span class="s2">;</span>
        <span class="s1">document.body.appendChild(fullPageElem)</span><span class="s2">;</span>
        
        <span class="s0">// DOM changed (throttled) to fix height</span>
        <span class="s2">var </span><span class="s1">pendingRefresh</span><span class="s2">;</span>
        <span class="s1">refreshSize = </span><span class="s2">function </span><span class="s1">() {</span>
            <span class="s2">if </span><span class="s1">(pendingRefresh) </span><span class="s2">return; </span><span class="s0">// could also be: clearTimeout(pendingRefresh);</span>
            <span class="s1">pendingRefresh = setTimeout(</span><span class="s2">function </span><span class="s1">() {</span>
                <span class="s2">if </span><span class="s1">(isExcluded) </span><span class="s2">return; </span><span class="s0">// could be running after cleanup</span>
                <span class="s1">fullPageElem.style.height = </span><span class="s4">'0'</span><span class="s2">;</span>
                <span class="s1">fullPageElem.style.height = root.scrollHeight + </span><span class="s4">'px'</span><span class="s2">;</span>
                <span class="s1">pendingRefresh = </span><span class="s2">null;</span>
            <span class="s1">}</span><span class="s2">, </span><span class="s3">500</span><span class="s1">)</span><span class="s2">; </span><span class="s0">// act rarely to stay fast</span>
        <span class="s1">}</span><span class="s2">;</span>
  
        <span class="s1">setTimeout(refreshSize</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span><span class="s2">;</span>

        <span class="s1">addEvent(</span><span class="s4">'resize'</span><span class="s2">, </span><span class="s1">refreshSize)</span><span class="s2">;</span>

        <span class="s0">// TODO: attributeFilter?</span>
        <span class="s2">var </span><span class="s1">config = {</span>
            <span class="s1">attributes: </span><span class="s2">true, </span>
            <span class="s1">childList: </span><span class="s2">true, </span>
            <span class="s1">characterData: </span><span class="s2">false </span>
            <span class="s0">// subtree: true</span>
        <span class="s1">}</span><span class="s2">;</span>

        <span class="s1">observer = </span><span class="s2">new </span><span class="s1">MutationObserver(refreshSize)</span><span class="s2">;</span>
        <span class="s1">observer.observe(body</span><span class="s2">, </span><span class="s1">config)</span><span class="s2">;</span>

        <span class="s2">if </span><span class="s1">(root.offsetHeight &lt;= windowHeight) {</span>
            <span class="s2">var </span><span class="s1">clearfix = document.createElement(</span><span class="s4">'div'</span><span class="s1">)</span><span class="s2">;   </span>
            <span class="s1">clearfix.style.clear = </span><span class="s4">'both'</span><span class="s2">;</span>
            <span class="s1">body.appendChild(clearfix)</span><span class="s2">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">// disable fixed background</span>
    <span class="s2">if </span><span class="s1">(!options.fixedBackground &amp;&amp; !isExcluded) {</span>
        <span class="s1">body.style.backgroundAttachment = </span><span class="s4">'scroll'</span><span class="s2">;</span>
        <span class="s1">html.style.backgroundAttachment = </span><span class="s4">'scroll'</span><span class="s2">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">* Removes event listeners and other traces left on the page.</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">cleanup() {</span>
    <span class="s1">observer &amp;&amp; observer.disconnect()</span><span class="s2">;</span>
    <span class="s1">removeEvent(wheelEvent</span><span class="s2">, </span><span class="s1">wheel)</span><span class="s2">;</span>
    <span class="s1">removeEvent(</span><span class="s4">'mousedown'</span><span class="s2">, </span><span class="s1">mousedown)</span><span class="s2">;</span>
    <span class="s1">removeEvent(</span><span class="s4">'keydown'</span><span class="s2">, </span><span class="s1">keydown)</span><span class="s2">;</span>
    <span class="s1">removeEvent(</span><span class="s4">'resize'</span><span class="s2">, </span><span class="s1">refreshSize)</span><span class="s2">;</span>
    <span class="s1">removeEvent(</span><span class="s4">'load'</span><span class="s2">, </span><span class="s1">init)</span><span class="s2">;</span>
<span class="s1">}</span>


<span class="s5">/************************************************</span>
 <span class="s5">* SCROLLING </span>
 <span class="s5">************************************************/</span>
 
<span class="s2">var </span><span class="s1">que = []</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">pending = </span><span class="s2">false;</span>
<span class="s2">var </span><span class="s1">lastScroll = Date.now()</span><span class="s2">;</span>

<span class="s5">/**</span>
 <span class="s5">* Pushes scroll actions to the scrolling queue.</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">scrollArray(elem</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">top) {</span>
    
    <span class="s1">directionCheck(left</span><span class="s2">, </span><span class="s1">top)</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(options.accelerationMax != </span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s2">var </span><span class="s1">now = Date.now()</span><span class="s2">;</span>
        <span class="s2">var </span><span class="s1">elapsed = now - lastScroll</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(elapsed &lt; options.accelerationDelta) {</span>
            <span class="s2">var </span><span class="s1">factor = (</span><span class="s3">1 </span><span class="s1">+ (</span><span class="s3">50 </span><span class="s1">/ elapsed)) / </span><span class="s3">2</span><span class="s2">;</span>
            <span class="s2">if </span><span class="s1">(factor &gt; </span><span class="s3">1</span><span class="s1">) {</span>
                <span class="s1">factor = Math.min(factor</span><span class="s2">, </span><span class="s1">options.accelerationMax)</span><span class="s2">;</span>
                <span class="s1">left *= factor</span><span class="s2">;</span>
                <span class="s1">top  *= factor</span><span class="s2">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s1">lastScroll = Date.now()</span><span class="s2">;</span>
    <span class="s1">}          </span>
    
    <span class="s0">// push a scroll command</span>
    <span class="s1">que.push({</span>
        <span class="s1">x: left</span><span class="s2">, </span>
        <span class="s1">y: top</span><span class="s2">, </span>
        <span class="s1">lastX: (left &lt; </span><span class="s3">0</span><span class="s1">) ? </span><span class="s3">0.99 </span><span class="s1">: -</span><span class="s3">0.99</span><span class="s2">,</span>
        <span class="s1">lastY: (top  &lt; </span><span class="s3">0</span><span class="s1">) ? </span><span class="s3">0.99 </span><span class="s1">: -</span><span class="s3">0.99</span><span class="s2">, </span>
        <span class="s1">start: Date.now()</span>
    <span class="s1">})</span><span class="s2">;</span>
        
    <span class="s0">// don't act if there's a pending queue</span>
    <span class="s2">if </span><span class="s1">(pending) {</span>
        <span class="s2">return;</span>
    <span class="s1">}  </span>

    <span class="s2">var </span><span class="s1">scrollWindow = (elem === document.body)</span><span class="s2">;</span>
    
    <span class="s2">var </span><span class="s1">step = </span><span class="s2">function </span><span class="s1">(time) {</span>
        
        <span class="s2">var </span><span class="s1">now = Date.now()</span><span class="s2">;</span>
        <span class="s2">var </span><span class="s1">scrollX = </span><span class="s3">0</span><span class="s2">;</span>
        <span class="s2">var </span><span class="s1">scrollY = </span><span class="s3">0</span><span class="s2">; </span>
    
        <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i &lt; que.length</span><span class="s2">; </span><span class="s1">i++) {</span>
            
            <span class="s2">var </span><span class="s1">item = que[i]</span><span class="s2">;</span>
            <span class="s2">var </span><span class="s1">elapsed  = now - item.start</span><span class="s2">;</span>
            <span class="s2">var </span><span class="s1">finished = (elapsed &gt;= options.animationTime)</span><span class="s2">;</span>
            
            <span class="s0">// scroll position: [0, 1]</span>
            <span class="s2">var </span><span class="s1">position = (finished) ? </span><span class="s3">1 </span><span class="s1">: elapsed / options.animationTime</span><span class="s2">;</span>
            
            <span class="s0">// easing [optional]</span>
            <span class="s2">if </span><span class="s1">(options.pulseAlgorithm) {</span>
                <span class="s1">position = pulse(position)</span><span class="s2">;</span>
            <span class="s1">}</span>
            
            <span class="s0">// only need the difference</span>
            <span class="s2">var </span><span class="s1">x = (item.x * position - item.lastX) &gt;&gt; </span><span class="s3">0</span><span class="s2">;</span>
            <span class="s2">var </span><span class="s1">y = (item.y * position - item.lastY) &gt;&gt; </span><span class="s3">0</span><span class="s2">;</span>
            
            <span class="s0">// add this to the total scrolling</span>
            <span class="s1">scrollX += x</span><span class="s2">;</span>
            <span class="s1">scrollY += y</span><span class="s2">;            </span>
            
            <span class="s0">// update last values</span>
            <span class="s1">item.lastX += x</span><span class="s2">;</span>
            <span class="s1">item.lastY += y</span><span class="s2">;</span>
        
            <span class="s0">// delete and step back if it's over</span>
            <span class="s2">if </span><span class="s1">(finished) {</span>
                <span class="s1">que.splice(i</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">; </span><span class="s1">i--</span><span class="s2">;</span>
            <span class="s1">}           </span>
        <span class="s1">}</span>

        <span class="s0">// scroll left and top</span>
        <span class="s2">if </span><span class="s1">(scrollWindow) {</span>
            <span class="s1">window.scrollBy(scrollX</span><span class="s2">, </span><span class="s1">scrollY)</span><span class="s2">;</span>
        <span class="s1">} </span>
        <span class="s2">else </span><span class="s1">{</span>
            <span class="s2">if </span><span class="s1">(scrollX) elem.scrollLeft += scrollX</span><span class="s2">;</span>
            <span class="s2">if </span><span class="s1">(scrollY) elem.scrollTop  += scrollY</span><span class="s2">;                    </span>
        <span class="s1">}</span>
        
        <span class="s0">// clean up if there's nothing left to do</span>
        <span class="s2">if </span><span class="s1">(!left &amp;&amp; !top) {</span>
            <span class="s1">que = []</span><span class="s2">;</span>
        <span class="s1">}</span>
        
        <span class="s2">if </span><span class="s1">(que.length) { </span>
            <span class="s1">requestFrame(step</span><span class="s2">, </span><span class="s1">elem</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1000 </span><span class="s1">/ options.frameRate + </span><span class="s3">1</span><span class="s1">))</span><span class="s2">; </span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{ </span>
            <span class="s1">pending = </span><span class="s2">false;</span>
        <span class="s1">}</span>
    <span class="s1">}</span><span class="s2">;</span>
    
    <span class="s0">// start a new queue of actions</span>
    <span class="s1">requestFrame(step</span><span class="s2">, </span><span class="s1">elem</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">pending = </span><span class="s2">true;</span>
<span class="s1">}</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* EVENTS</span>
 <span class="s5">***********************************************/</span>

<span class="s5">/**</span>
 <span class="s5">* Mouse wheel handler.</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Object} event</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">wheel(event) {</span>

    <span class="s2">if </span><span class="s1">(!initDone) {</span>
        <span class="s1">init()</span><span class="s2">;</span>
    <span class="s1">}</span>
    
    <span class="s2">var </span><span class="s1">target = event.target</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">overflowing = overflowingAncestor(target)</span><span class="s2">;</span>

    <span class="s0">// use default if there's no overflowing</span>
    <span class="s0">// element or default action is prevented   </span>
    <span class="s0">// or it's a zooming event with CTRL </span>
    <span class="s2">if </span><span class="s1">(!overflowing || event.defaultPrevented || event.ctrlKey) {</span>
        <span class="s2">return true;</span>
    <span class="s1">}</span>
    
    <span class="s0">// leave embedded content alone (flash &amp; pdf)</span>
    <span class="s2">if </span><span class="s1">(isNodeName(activeElement</span><span class="s2">, </span><span class="s4">'embed'</span><span class="s1">) || </span>
       <span class="s1">(isNodeName(target</span><span class="s2">, </span><span class="s4">'embed'</span><span class="s1">) &amp;&amp; </span><span class="s3">/\.pdf/i</span><span class="s1">.test(target.src)) ||</span>
       <span class="s1">isNodeName(activeElement</span><span class="s2">, </span><span class="s4">'object'</span><span class="s1">)) {</span>
        <span class="s2">return true;</span>
    <span class="s1">}</span>

    <span class="s2">var </span><span class="s1">deltaX = -event.wheelDeltaX || event.deltaX || </span><span class="s3">0</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">deltaY = -event.wheelDeltaY || event.deltaY || </span><span class="s3">0</span><span class="s2">;</span>
    
    <span class="s2">if </span><span class="s1">(isMac) {</span>
        <span class="s2">if </span><span class="s1">(event.wheelDeltaX &amp;&amp; isDivisible(event.wheelDeltaX</span><span class="s2">, </span><span class="s3">120</span><span class="s1">)) {</span>
            <span class="s1">deltaX = -</span><span class="s3">120 </span><span class="s1">* (event.wheelDeltaX / Math.abs(event.wheelDeltaX))</span><span class="s2">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(event.wheelDeltaY &amp;&amp; isDivisible(event.wheelDeltaY</span><span class="s2">, </span><span class="s3">120</span><span class="s1">)) {</span>
            <span class="s1">deltaY = -</span><span class="s3">120 </span><span class="s1">* (event.wheelDeltaY / Math.abs(event.wheelDeltaY))</span><span class="s2">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    
    <span class="s0">// use wheelDelta if deltaX/Y is not available</span>
    <span class="s2">if </span><span class="s1">(!deltaX &amp;&amp; !deltaY) {</span>
        <span class="s1">deltaY = -event.wheelDelta || </span><span class="s3">0</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s0">// line based scrolling (Firefox mostly)</span>
    <span class="s2">if </span><span class="s1">(event.deltaMode === </span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s1">deltaX *= </span><span class="s3">40</span><span class="s2">;</span>
        <span class="s1">deltaY *= </span><span class="s3">40</span><span class="s2">;</span>
    <span class="s1">}</span>
    
    <span class="s0">// check if it's a touchpad scroll that should be ignored</span>
    <span class="s2">if </span><span class="s1">(!options.touchpadSupport &amp;&amp; isTouchpad(deltaY)) {</span>
        <span class="s2">return true;</span>
    <span class="s1">}</span>

    <span class="s0">// scale by step size</span>
    <span class="s0">// delta is 120 most of the time</span>
    <span class="s0">// synaptics seems to send 1 sometimes</span>
    <span class="s2">if </span><span class="s1">(Math.abs(deltaX) &gt; </span><span class="s3">1.2</span><span class="s1">) {</span>
        <span class="s1">deltaX *= options.stepSize / </span><span class="s3">120</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(Math.abs(deltaY) &gt; </span><span class="s3">1.2</span><span class="s1">) {</span>
        <span class="s1">deltaY *= options.stepSize / </span><span class="s3">120</span><span class="s2">;</span>
    <span class="s1">}</span>
    
    <span class="s1">scrollArray(overflowing</span><span class="s2">, </span><span class="s1">deltaX</span><span class="s2">, </span><span class="s1">deltaY)</span><span class="s2">;</span>
    <span class="s1">event.preventDefault()</span><span class="s2">;</span>
    <span class="s1">scheduleClearCache()</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">* Keydown event handler.</span>
 <span class="s5">* </span><span class="s6">@param </span><span class="s5">{Object} event</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">keydown(event) {</span>

    <span class="s2">var </span><span class="s1">target   = event.target</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">modifier = event.ctrlKey || event.altKey || event.metaKey || </span>
                  <span class="s1">(event.shiftKey &amp;&amp; event.keyCode !== key.spacebar)</span><span class="s2">;</span>
    
    <span class="s0">// our own tracked active element could've been removed from the DOM</span>
    <span class="s2">if </span><span class="s1">(!document.contains(activeElement)) {</span>
        <span class="s1">activeElement = document.activeElement</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s0">// do nothing if user is editing text</span>
    <span class="s0">// or using a modifier key (except shift)</span>
    <span class="s0">// or in a dropdown</span>
    <span class="s0">// or inside interactive elements</span>
    <span class="s2">var </span><span class="s1">inputNodeNames = </span><span class="s3">/^(textarea|select|embed|object)$/i</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">buttonTypes = </span><span class="s3">/^(button|submit|radio|checkbox|file|color|image)$/i</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">( inputNodeNames.test(target.nodeName) ||</span>
         <span class="s1">isNodeName(target</span><span class="s2">, </span><span class="s4">'input'</span><span class="s1">) &amp;&amp; !buttonTypes.test(target.type) ||</span>
         <span class="s1">isNodeName(activeElement</span><span class="s2">, </span><span class="s4">'video'</span><span class="s1">) ||</span>
         <span class="s1">isInsideYoutubeVideo(event) ||</span>
         <span class="s1">target.isContentEditable || </span>
         <span class="s1">event.defaultPrevented   ||</span>
         <span class="s1">modifier ) {</span>
      <span class="s2">return true;</span>
    <span class="s1">}</span>
    
    <span class="s0">// spacebar should trigger button press</span>
    <span class="s2">if </span><span class="s1">((isNodeName(target</span><span class="s2">, </span><span class="s4">'button'</span><span class="s1">) ||</span>
         <span class="s1">isNodeName(target</span><span class="s2">, </span><span class="s4">'input'</span><span class="s1">) &amp;&amp; buttonTypes.test(target.type)) &amp;&amp;</span>
        <span class="s1">event.keyCode === key.spacebar) {</span>
      <span class="s2">return true;</span>
    <span class="s1">}</span>
    
    <span class="s2">var </span><span class="s1">shift</span><span class="s2">, </span><span class="s1">x = </span><span class="s3">0</span><span class="s2">, </span><span class="s1">y = </span><span class="s3">0</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">elem = overflowingAncestor(activeElement)</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">clientHeight = elem.clientHeight</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(elem == document.body) {</span>
        <span class="s1">clientHeight = window.innerHeight</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s2">switch </span><span class="s1">(event.keyCode) {</span>
        <span class="s2">case </span><span class="s1">key.up:</span>
            <span class="s1">y = -options.arrowScroll</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.down:</span>
            <span class="s1">y = options.arrowScroll</span><span class="s2">;</span>
            <span class="s2">break;         </span>
        <span class="s2">case </span><span class="s1">key.spacebar: </span><span class="s0">// (+ shift)</span>
            <span class="s1">shift = event.shiftKey ? </span><span class="s3">1 </span><span class="s1">: -</span><span class="s3">1</span><span class="s2">;</span>
            <span class="s1">y = -shift * clientHeight * </span><span class="s3">0.9</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.pageup:</span>
            <span class="s1">y = -clientHeight * </span><span class="s3">0.9</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.pagedown:</span>
            <span class="s1">y = clientHeight * </span><span class="s3">0.9</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.home:</span>
            <span class="s1">y = -elem.scrollTop</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.end:</span>
            <span class="s2">var </span><span class="s1">damt = elem.scrollHeight - elem.scrollTop - clientHeight</span><span class="s2">;</span>
            <span class="s1">y = (damt &gt; </span><span class="s3">0</span><span class="s1">) ? damt+</span><span class="s3">10 </span><span class="s1">: </span><span class="s3">0</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.left:</span>
            <span class="s1">x = -options.arrowScroll</span><span class="s2">;</span>
            <span class="s2">break;</span>
        <span class="s2">case </span><span class="s1">key.right:</span>
            <span class="s1">x = options.arrowScroll</span><span class="s2">;</span>
            <span class="s2">break;            </span>
        <span class="s2">default</span><span class="s1">:</span>
            <span class="s2">return true; </span><span class="s0">// a key we don't care about</span>
    <span class="s1">}</span>

    <span class="s1">scrollArray(elem</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">;</span>
    <span class="s1">event.preventDefault()</span><span class="s2">;</span>
    <span class="s1">scheduleClearCache()</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s5">/**</span>
 <span class="s5">* Mousedown event only for updating activeElement</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">mousedown(event) {</span>
    <span class="s1">activeElement = event.target</span><span class="s2">;</span>
<span class="s1">}</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* OVERFLOW</span>
 <span class="s5">***********************************************/</span>

<span class="s2">var </span><span class="s1">uniqueID = (</span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s2">;</span>
    <span class="s2">return function </span><span class="s1">(el) {</span>
        <span class="s2">return </span><span class="s1">el.uniqueID || (el.uniqueID = i++)</span><span class="s2">;</span>
    <span class="s1">}</span><span class="s2">;</span>
<span class="s1">})()</span><span class="s2">;</span>

<span class="s2">var </span><span class="s1">cache = {}</span><span class="s2">; </span><span class="s0">// cleared out after a scrolling session</span>
<span class="s2">var </span><span class="s1">clearCacheTimer</span><span class="s2">;</span>

<span class="s0">//setInterval(function () { cache = {}; }, 10 * 1000);</span>

<span class="s2">function </span><span class="s1">scheduleClearCache() {</span>
    <span class="s1">clearTimeout(clearCacheTimer)</span><span class="s2">;</span>
    <span class="s1">clearCacheTimer = setInterval(</span><span class="s2">function </span><span class="s1">() { cache = {}</span><span class="s2">; </span><span class="s1">}</span><span class="s2">, </span><span class="s3">1</span><span class="s1">*</span><span class="s3">1000</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">setCache(elems</span><span class="s2">, </span><span class="s1">overflowing) {</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = elems.length</span><span class="s2">; </span><span class="s1">i--</span><span class="s2">;</span><span class="s1">)</span>
        <span class="s1">cache[uniqueID(elems[i])] = overflowing</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">overflowing</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s0">//  (body)                (root)</span>
<span class="s0">//         | hidden | visible | scroll |  auto  |</span>
<span class="s0">// hidden  |   no   |    no   |   YES  |   YES  |</span>
<span class="s0">// visible |   no   |   YES   |   YES  |   YES  |</span>
<span class="s0">// scroll  |   no   |   YES   |   YES  |   YES  |</span>
<span class="s0">// auto    |   no   |   YES   |   YES  |   YES  |</span>

<span class="s2">function </span><span class="s1">overflowingAncestor(el) {</span>
    <span class="s2">var </span><span class="s1">elems = []</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">body = document.body</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">rootScrollHeight = root.scrollHeight</span><span class="s2">;</span>
    <span class="s2">do </span><span class="s1">{</span>
        <span class="s2">var </span><span class="s1">cached = cache[uniqueID(el)]</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(cached) {</span>
            <span class="s2">return </span><span class="s1">setCache(elems</span><span class="s2">, </span><span class="s1">cached)</span><span class="s2">;</span>
        <span class="s1">}</span>
        <span class="s1">elems.push(el)</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(rootScrollHeight === el.scrollHeight) {</span>
            <span class="s2">var </span><span class="s1">topOverflowsNotHidden = overflowNotHidden(root) &amp;&amp; overflowNotHidden(body)</span><span class="s2">;</span>
            <span class="s2">var </span><span class="s1">isOverflowCSS = topOverflowsNotHidden || overflowAutoOrScroll(root)</span><span class="s2">;</span>
            <span class="s2">if </span><span class="s1">(isFrame &amp;&amp; isContentOverflowing(root) || </span>
               <span class="s1">!isFrame &amp;&amp; isOverflowCSS) {</span>
                <span class="s2">return </span><span class="s1">setCache(elems</span><span class="s2">, </span><span class="s1">getScrollRoot())</span><span class="s2">; </span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(isContentOverflowing(el) &amp;&amp; overflowAutoOrScroll(el)) {</span>
            <span class="s2">return </span><span class="s1">setCache(elems</span><span class="s2">, </span><span class="s1">el)</span><span class="s2">;</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">while </span><span class="s1">(el = el.parentElement)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">isContentOverflowing(el) {</span>
    <span class="s2">return </span><span class="s1">(el.clientHeight + </span><span class="s3">10 </span><span class="s1">&lt; el.scrollHeight)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s0">// typically for &lt;body&gt; and &lt;html&gt;</span>
<span class="s2">function </span><span class="s1">overflowNotHidden(el) {</span>
    <span class="s2">var </span><span class="s1">overflow = getComputedStyle(el</span><span class="s2">, </span><span class="s4">''</span><span class="s1">).getPropertyValue(</span><span class="s4">'overflow-y'</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">(overflow !== </span><span class="s4">'hidden'</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s0">// for all other elements</span>
<span class="s2">function </span><span class="s1">overflowAutoOrScroll(el) {</span>
    <span class="s2">var </span><span class="s1">overflow = getComputedStyle(el</span><span class="s2">, </span><span class="s4">''</span><span class="s1">).getPropertyValue(</span><span class="s4">'overflow-y'</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">(overflow === </span><span class="s4">'scroll' </span><span class="s1">|| overflow === </span><span class="s4">'auto'</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">}</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* HELPERS</span>
 <span class="s5">***********************************************/</span>

<span class="s2">function </span><span class="s1">addEvent(type</span><span class="s2">, </span><span class="s1">fn) {</span>
    <span class="s1">window.addEventListener(type</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">, false</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">removeEvent(type</span><span class="s2">, </span><span class="s1">fn) {</span>
    <span class="s1">window.removeEventListener(type</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">, false</span><span class="s1">)</span><span class="s2">;  </span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">isNodeName(el</span><span class="s2">, </span><span class="s1">tag) {</span>
    <span class="s2">return </span><span class="s1">(el.nodeName||</span><span class="s4">''</span><span class="s1">).toLowerCase() === tag.toLowerCase()</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">directionCheck(x</span><span class="s2">, </span><span class="s1">y) {</span>
    <span class="s1">x = (x &gt; </span><span class="s3">0</span><span class="s1">) ? </span><span class="s3">1 </span><span class="s1">: -</span><span class="s3">1</span><span class="s2">;</span>
    <span class="s1">y = (y &gt; </span><span class="s3">0</span><span class="s1">) ? </span><span class="s3">1 </span><span class="s1">: -</span><span class="s3">1</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(direction.x !== x || direction.y !== y) {</span>
        <span class="s1">direction.x = x</span><span class="s2">;</span>
        <span class="s1">direction.y = y</span><span class="s2">;</span>
        <span class="s1">que = []</span><span class="s2">;</span>
        <span class="s1">lastScroll = </span><span class="s3">0</span><span class="s2">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s2">var </span><span class="s1">deltaBufferTimer</span><span class="s2">;</span>

<span class="s2">if </span><span class="s1">(window.localStorage &amp;&amp; localStorage.SS_deltaBuffer) {</span>
    <span class="s1">deltaBuffer = localStorage.SS_deltaBuffer.split(</span><span class="s4">','</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">isTouchpad(deltaY) {</span>
    <span class="s2">if </span><span class="s1">(!deltaY) </span><span class="s2">return;</span>
    <span class="s2">if </span><span class="s1">(!deltaBuffer.length) {</span>
        <span class="s1">deltaBuffer = [deltaY</span><span class="s2">, </span><span class="s1">deltaY</span><span class="s2">, </span><span class="s1">deltaY]</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s1">deltaY = Math.abs(deltaY)</span>
    <span class="s1">deltaBuffer.push(deltaY)</span><span class="s2">;</span>
    <span class="s1">deltaBuffer.shift()</span><span class="s2">;</span>
    <span class="s1">clearTimeout(deltaBufferTimer)</span><span class="s2">;</span>
    <span class="s1">deltaBufferTimer = setTimeout(</span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">if </span><span class="s1">(window.localStorage) {</span>
            <span class="s1">localStorage.SS_deltaBuffer = deltaBuffer.join(</span><span class="s4">','</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span><span class="s2">, </span><span class="s3">1000</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">!allDeltasDivisableBy(</span><span class="s3">120</span><span class="s1">) &amp;&amp; !allDeltasDivisableBy(</span><span class="s3">100</span><span class="s1">)</span><span class="s2">;</span>
<span class="s1">} </span>

<span class="s2">function </span><span class="s1">isDivisible(n</span><span class="s2">, </span><span class="s1">divisor) {</span>
    <span class="s2">return </span><span class="s1">(Math.floor(n / divisor) == n / divisor)</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">allDeltasDivisableBy(divisor) {</span>
    <span class="s2">return </span><span class="s1">(isDivisible(deltaBuffer[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">divisor) &amp;&amp;</span>
            <span class="s1">isDivisible(deltaBuffer[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">divisor) &amp;&amp;</span>
            <span class="s1">isDivisible(deltaBuffer[</span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">divisor))</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">isInsideYoutubeVideo(event) {</span>
    <span class="s2">var </span><span class="s1">elem = event.target</span><span class="s2">;</span>
    <span class="s2">var </span><span class="s1">isControl = </span><span class="s2">false;</span>
    <span class="s2">if </span><span class="s1">(document.URL.indexOf (</span><span class="s4">'www.youtube.com/watch'</span><span class="s1">) != -</span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s2">do </span><span class="s1">{</span>
            <span class="s1">isControl = (elem.classList &amp;&amp; </span>
                         <span class="s1">elem.classList.contains(</span><span class="s4">'html5-video-controls'</span><span class="s1">))</span><span class="s2">;</span>
            <span class="s2">if </span><span class="s1">(isControl) </span><span class="s2">break;</span>
        <span class="s1">} </span><span class="s2">while </span><span class="s1">(elem = elem.parentNode)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">isControl</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">var </span><span class="s1">requestFrame = (</span><span class="s2">function </span><span class="s1">() {</span>
      <span class="s2">return </span><span class="s1">(window.requestAnimationFrame       || </span>
              <span class="s1">window.webkitRequestAnimationFrame || </span>
              <span class="s1">window.mozRequestAnimationFrame    ||</span>
              <span class="s2">function </span><span class="s1">(callback</span><span class="s2">, </span><span class="s1">element</span><span class="s2">, </span><span class="s1">delay) {</span>
                 <span class="s1">window.setTimeout(callback</span><span class="s2">, </span><span class="s1">delay || (</span><span class="s3">1000</span><span class="s1">/</span><span class="s3">60</span><span class="s1">))</span><span class="s2">;</span>
             <span class="s1">})</span><span class="s2">;</span>
<span class="s1">})()</span><span class="s2">;</span>

<span class="s2">var </span><span class="s1">MutationObserver = (window.MutationObserver || </span>
                        <span class="s1">window.WebKitMutationObserver ||</span>
                        <span class="s1">window.MozMutationObserver)</span><span class="s2">;  </span>

<span class="s2">var </span><span class="s1">getScrollRoot = (</span><span class="s2">function</span><span class="s1">() {</span>
  <span class="s2">var </span><span class="s1">SCROLL_ROOT</span><span class="s2">;</span>
  <span class="s2">return function</span><span class="s1">() {</span>
    <span class="s2">if </span><span class="s1">(!SCROLL_ROOT) {</span>
      <span class="s2">var </span><span class="s1">dummy = document.createElement(</span><span class="s4">'div'</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s1">dummy.style.cssText = </span><span class="s4">'height:10000px;width:1px;'</span><span class="s2">;</span>
      <span class="s1">document.body.appendChild(dummy)</span><span class="s2">;</span>
      <span class="s2">var </span><span class="s1">bodyScrollTop  = document.body.scrollTop</span><span class="s2">;</span>
      <span class="s2">var </span><span class="s1">docElScrollTop = document.documentElement.scrollTop</span><span class="s2">;</span>
      <span class="s1">window.scrollBy(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(document.body.scrollTop != bodyScrollTop)</span>
        <span class="s1">(SCROLL_ROOT = document.body)</span><span class="s2">;</span>
      <span class="s2">else </span>
        <span class="s1">(SCROLL_ROOT = document.documentElement)</span><span class="s2">;</span>
      <span class="s1">window.scrollBy(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s1">document.body.removeChild(dummy)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">SCROLL_ROOT</span><span class="s2">;</span>
  <span class="s1">}</span><span class="s2">;</span>
<span class="s1">})()</span><span class="s2">;</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* PULSE (by Michael Herf)</span>
 <span class="s5">***********************************************/</span>
 
<span class="s5">/**</span>
 <span class="s5">* Viscous fluid with a pulse for part and decay for the rest.</span>
 <span class="s5">* - Applies a fixed force over an interval (a damped acceleration), and</span>
 <span class="s5">* - Lets the exponential bleed away the velocity over a longer interval</span>
 <span class="s5">* - Michael Herf, http://stereopsis.com/stopping/</span>
 <span class="s5">*/</span>
<span class="s2">function </span><span class="s1">pulse_(x) {</span>
    <span class="s2">var </span><span class="s1">val</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">expx</span><span class="s2">;</span>
    <span class="s0">// test</span>
    <span class="s1">x = x * options.pulseScale</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(x &lt; </span><span class="s3">1</span><span class="s1">) { </span><span class="s0">// acceleartion</span>
        <span class="s1">val = x - (</span><span class="s3">1 </span><span class="s1">- Math.exp(-x))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{     </span><span class="s0">// tail</span>
        <span class="s0">// the previous animation ended here:</span>
        <span class="s1">start = Math.exp(-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s0">// simple viscous drag</span>
        <span class="s1">x -= </span><span class="s3">1</span><span class="s2">;</span>
        <span class="s1">expx = </span><span class="s3">1 </span><span class="s1">- Math.exp(-x)</span><span class="s2">;</span>
        <span class="s1">val = start + (expx * (</span><span class="s3">1 </span><span class="s1">- start))</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">val * options.pulseNormalize</span><span class="s2">;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">pulse(x) {</span>
    <span class="s2">if </span><span class="s1">(x &gt;= </span><span class="s3">1</span><span class="s1">) </span><span class="s2">return </span><span class="s3">1</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(x &lt;= </span><span class="s3">0</span><span class="s1">) </span><span class="s2">return </span><span class="s3">0</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(options.pulseNormalize == </span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s1">options.pulseNormalize /= pulse_(</span><span class="s3">1</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">pulse_(x)</span><span class="s2">;</span>
<span class="s1">}</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* FIRST RUN</span>
 <span class="s5">***********************************************/</span>

<span class="s2">var </span><span class="s1">userAgent = window.navigator.userAgent</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">isEdge    = </span><span class="s3">/Edge/</span><span class="s1">.test(userAgent)</span><span class="s2">; </span><span class="s0">// thank you MS</span>
<span class="s2">var </span><span class="s1">isChrome  = </span><span class="s3">/chrome/i</span><span class="s1">.test(userAgent) &amp;&amp; !isEdge</span><span class="s2">; </span>
<span class="s2">var </span><span class="s1">isSafari  = </span><span class="s3">/safari/i</span><span class="s1">.test(userAgent) &amp;&amp; !isEdge</span><span class="s2">; </span>
<span class="s2">var </span><span class="s1">isMobile  = </span><span class="s3">/mobile/i</span><span class="s1">.test(userAgent)</span><span class="s2">;</span>
<span class="s2">var </span><span class="s1">isEnabledForBrowser = (isChrome || isSafari) &amp;&amp; !isMobile</span><span class="s2">;</span>

<span class="s2">var </span><span class="s1">wheelEvent</span><span class="s2">;</span>
<span class="s2">if </span><span class="s1">(</span><span class="s4">'onwheel' </span><span class="s2">in </span><span class="s1">document.createElement(</span><span class="s4">'div'</span><span class="s1">))</span>
    <span class="s1">wheelEvent = </span><span class="s4">'wheel'</span><span class="s2">;</span>
<span class="s2">else if </span><span class="s1">(</span><span class="s4">'onmousewheel' </span><span class="s2">in </span><span class="s1">document.createElement(</span><span class="s4">'div'</span><span class="s1">))</span>
    <span class="s1">wheelEvent = </span><span class="s4">'mousewheel'</span><span class="s2">;</span>

<span class="s2">if </span><span class="s1">(wheelEvent &amp;&amp; isEnabledForBrowser) {</span>
    <span class="s1">addEvent(wheelEvent</span><span class="s2">, </span><span class="s1">wheel)</span><span class="s2">;</span>
    <span class="s1">addEvent(</span><span class="s4">'mousedown'</span><span class="s2">, </span><span class="s1">mousedown)</span><span class="s2">;</span>
    <span class="s1">addEvent(</span><span class="s4">'load'</span><span class="s2">, </span><span class="s1">init)</span><span class="s2">;</span>
<span class="s1">}</span>


<span class="s5">/***********************************************</span>
 <span class="s5">* PUBLIC INTERFACE</span>
 <span class="s5">***********************************************/</span>

<span class="s2">function </span><span class="s1">SmoothScroll(optionsToSet) {</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">key </span><span class="s2">in </span><span class="s1">optionsToSet)</span>
        <span class="s2">if </span><span class="s1">(defaultOptions.hasOwnProperty(key)) </span>
            <span class="s1">options[key] = optionsToSet[key]</span><span class="s2">;</span>
<span class="s1">}</span>
<span class="s1">SmoothScroll.destroy = cleanup</span><span class="s2">;</span>

<span class="s2">if </span><span class="s1">(window.SmoothScrollOptions) </span><span class="s0">// async API</span>
    <span class="s1">SmoothScroll(window.SmoothScrollOptions)</span>

<span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">define === </span><span class="s4">'function' </span><span class="s1">&amp;&amp; define.amd)</span>
    <span class="s1">define(</span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">SmoothScroll</span><span class="s2">;</span>
    <span class="s1">})</span><span class="s2">;</span>
<span class="s2">else if </span><span class="s1">(</span><span class="s4">'object' </span><span class="s1">== </span><span class="s2">typeof </span><span class="s1">exports)</span>
    <span class="s1">module.exports = SmoothScroll</span><span class="s2">;</span>
<span class="s2">else</span>
    <span class="s1">window.SmoothScroll = SmoothScroll</span><span class="s2">;</span>

<span class="s1">})()</span><span class="s2">;</span></pre>
</body>
</html>